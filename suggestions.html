<!-- codepage utf-8 -->
<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
</head>
<body>

<h1>Предложения к спецификации Тралива</h1>

<h2>Автоподгон размеров виджетов под содержимое, дополнения к политике размеров виджетов</h2>
<p>Это относится только к определению размеров в контейнере виджетов Stack (ну и всплывающих виджетов(см. следующее предложение)).</p>
<p>Сейчас размеры элемента в контенере Stack задаются как фиксированные в пикселях (32px) или как занимающие заданную часть от оставшегося после фиксированных элементов места (2part). Так вот, есть предложение расширить такую политику следующим образом:</p>
<ul>
<li>В класс _WidgetBase добавить метод sizeHint(), который должен возвращать минимальный размер, который требуется для того, чтобы контент виджета умещался. Дефолтная реализация - пробно отрисовать и посмотреть, сколько места занимает HTML-код.</li>
<li>Если требуется переопределение sizeHint-а, это делать в коде WidgetStateSubscriber-а</li>
<li>В класс _WidgetBase добавить метод sizeHintChanged() как сигнал, на который может подписаться родительский контейнер.</li>
<li>Не забыть переопределить (сбросить в дефолт) метод sizeHintChanged() при извлечении виджета из контейнера</li>
<li>Помимо px и part добавить спецслово ftc (Fit To Content), которое бы означало, что элемент должен занимать столько места, сколько указано в sizeHint-е</li>
<li>Добавить возможность задавать минимальные и максимальные размеры (min и max). Например, '2part;min:32px' означает 2 части от оставшегося места, но не менее 32 пикселей. Если отставшегося места в Strip-е недостаточно для задания нужного размеров элементам, у Strip-а должна появиться прокрутка (или не появиться в соответствии с политикой scroll).</li>
</ul>

<h2>Всплывающие виджеты и тултипы</h2>
<p> В класс WidgetStateSubscriber добавить метод setPopup(). Принимаемые параметры: </p>
<ol>
<li>Опорный виджет. Это может быть this или какой-то из его дочерних виджетов. Возможные типы этого параметра: WidgetStateSubscriber(в качестве опорного виджета берётся его _wContainer), _WidgetBase, DomElement.</li>
<li>Тип. Варианты:
    <ul>
    <li>'t' - Всплытие как тултип, т.е. отталкиваясь от позиции курсора</li>
    <li>'h' - Всплытие рядом по горизонали (в зависимости от того, где больше свободного места, справа или слева (при равных будет отображаться справа))</li>
    <li>'hl' - как при 'h', но при равных делать предпочтение на отображение слева</li>
    <li>'v' - Всплытие рядом по вертикали (в зависимости от того, где больше свободного места, сверху или снизу (при равных будет отображаться снизу))</li>
    <li>'vt' - как при 'v', но при равных делать предпочтение на отображение сверху</li>
    <li>'vh' - атоматическое определение, всплывать рядом по горизонтали или по вертикали</li>
    </ul>
    <p>При всплытии по горизонтали координата по вертикали по возможности выравнивается к верхнему краю опорного виджета</p>
</li>
<li>Всплывающий виджет. Может иметь один из следующий типов:</li>
<ul>
<li>Объект, как при описании виджета (свойства widget, substate и popup) или WidgetStateSubscriber. В таком случае виджет появляется сразу, как только заданное подсостояние валидно, и уничтожается, когда подсостояние становится невалидным</li>
<li>_WidgetBase</li>
<li>DOM-элемент</li>
<li>Текст</li>
</ul>
</ol>
<p>Время жизни и видимость всплывающего виджета привязаны к опорному виджету - как только опорный виджет меняет видимость, всплывающий виджет так же меняет свою видимость, при уничтожении опорного виджета уничтожается и всплывающий виджет (и всплывающие из всплывающего виджета также соответственно)</p>
<p>Всплывающие виджеты, для которых не указано подсостояние (которые перманентные), должны иметь возможность быть досрочно уничтожены путём вызова setPopup() с такими же типом и опорным виджетом, но с незаданным (или заданным как undefined) самим всплывающим виджетом.</p>
<p>Таким образом, для задания тултипа виджету в WidgetStateSubscriber-е необходимо прописать this.setPopup(this, 't', 'Текст тултипа').</p>
<p>В описании формата описания виджета необходимо добавить свойства popup, которое есть массив(или единственный экземпляр) из {объектов со свойствами type и widget} или {строк}. Строка, переданная в качестве popup, должна интерпретироваться как тултип.</p>
<p>Про реализацию всплывающих виджетов. Корневой виджет веб-приложения - Stack, в который добавляются главный лэйаут и виджет, на котором будут отображаться всплывающие виджеты. Сейчас пробрасываются события изменения размеров виджетов, надо, чтобы пробрасывались также и события изменения экранного положения виджетов.</p>

</body>
</html>
